C51 COMPILER V9.52.0.0   MAINAPP                                                           09/19/2017 10:16:41 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAINAPP
OBJECT MODULE PLACED IN .\Output\mainapp.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Code\mainapp.c OPTIMIZE(4,SPEED) BROWSE INCDIR(.\Code\Common;.\Code;.\Co
                    -de\BSP;.\Code\N76E003_HW) DEFINE(FOSC_160000) DEBUG OBJECTEXTEND PRINT(.\LST\mainapp.lst) TABS(2) OBJECT(.\Output\mainap
                    -p.obj)

line level    source

   1          /*--------------------------------------------------------------------------------------------------------
             --*/
   2          /*                                                                                                        
             - */
   3          /* Copyright(c) 2017 Buta Technology Corp. All rights reserved.                                         */
   4          /*                                                                                                        
             - */
   5          /*--------------------------------------------------------------------------------------------------------
             --*/
   6          
   7          //********************************************************************************************************
             -***
   8          //  Website: http://www.ptahtoy.com
   9          //  E-Mail : linshigao@ptahtoy.com
  10          //  Date   : Jun/24/2017
  11          //********************************************************************************************************
             -***
  12          
  13          //********************************************************************************************************
             -***
  14          //  File Function: BabyMonkey(Finger Toy) 
  15          //********************************************************************************************************
             -***
  16          #include "N76E003.h"
  17          #include "Common.h"
  18          #include "Delay.h"
  19          #include "Audio.h"
  20          #include "Board.h"
  21          #include "PWM.h"
  22          #include "motor.h"
  23          #include "SFR_Macro.h"
  24          #include "Function_define.h"
  25          #include "string.h"
  26          #include "UART.h"
  27          #include "LED.h"
  28          #include "ADC.h"
  29          
  30          /***********************Local function Define***********************/
  31          static void AppInit(void);
  32          static void AppTask(void);
  33          static void ClearSensorStatus(void);
  34          static void WakeupAction(void);
  35          /***********************Local Variables Define***********************/
  36          
  37          EUINT8 midletick;//1s per tick
  38           
  39          u8  uartData = 0; //????
  40          //u8  uartBuf[DATA_LEN];
  41          u8  num = 0;
  42          
  43          u8 dataPacket0;
  44          u8 dataPacket1;
  45          u8 speed = 0x00;
C51 COMPILER V9.52.0.0   MAINAPP                                                           09/19/2017 10:16:41 PAGE 2   

  46          u16 timeOutSonix = 0;//?????????
  47          
  48          /* ???? */
  49          void delay(void)   //?? 0us
  50          {
  51   1          unsigned char a,b;
  52   1          for(b=20;b>0;b--)
  53   1              for(a=1;a>0;a--);
  54   1      } 
  55          
  56          /*******************************************************************/
  57          //UINT16 mtcnt,mprevtcnt;
  58          void main (void) 
  59          {
  60   1      //  UINT16 minus;
  61   1        u8 motorOutFlag = 0;
  62   1        u16 i=0;
  63   1        u16 adc_val;
  64   1        
  65   1        AppInit();
  66   1        BoardInit();
  67   1        
  68   1        MyPrintf("Hello WiFI Car \r\n");
  69   1      
  70   1        while(1)
  71   1        {
  72   2          if(GetSysClock())//500uS
  73   2          {
  74   3            ResetSysClock();
  75   3            
  76   3            if(i>20)
  77   3            {
  78   4              i=0;
  79   4              adc_val = Get_ADC();
  80   4              if(adc_val > 200)
  81   4                SetMotor_STOP();
  82   4              
  83   4              //MyPrintf("ADC = ");
  84   4      //        Send_Data_To_UART0(adc_val/1000 + '0');
  85   4      //        Send_Data_To_UART0(adc_val%1000/100 + '0');
  86   4      //        Send_Data_To_UART0(adc_val%100/10 + '0');
  87   4      //        Send_Data_To_UART0(adc_val%10 + '0');
  88   4      //        MyPrintf("\r\n");
  89   4            }
  90   3            else
  91   3            {
  92   4              i++;
  93   4            }
  94   3            
  95   3            if(Check_Recieve_Valid())//接收到有效的数据包
  96   3            {
  97   4              Rx_Package_Handle(RX_Packet);
  98   4            }
  99   3            
 100   3            if(CheckTimeOut_Wifi())//WIFI信号超时
 101   3            {
 102   4              SetMotor_Brake();//刹车
 103   4              SetArm( ARM_STOP );
 104   4              SetClaw( CLAW_STOP );
 105   4            } 
 106   3            else 
 107   3            {
C51 COMPILER V9.52.0.0   MAINAPP                                                           09/19/2017 10:16:41 PAGE 3   

 108   4              //前后信号接收超时，刹车
 109   4              if(CheckTimeOut_Motor())
 110   4              {
 111   5                SetMotor_Brake();//刹车
 112   5              }
 113   4            }
 114   3            
 115   3            Indicator_Light();//指示灯显示
 116   3          }
 117   2        }
 118   1      }
 119          
 120          /*
 121          应用层的一些初始化
 122          */
 123          static void AppInit(void)
 124          {
 125   1        
 126   1      }
 127          
 128          /*
 129          应用层任务
 130          */
 131          static void AppTask(void)
 132          {
 133   1         
 134   1      }
 135          
 136          /*
 137            接收数据解析
 138            RX_Handle
 139          */
 140          void Rx_Package_Handle(uint8_t *uartBuf)
 141          {
 142   1        Set_TimeOut_Wifi();//WIFI超时复位
 143   1        SetWifiStatus();//设置WIFI为连接状态
 144   1        
 145   1        if( (uartBuf[2]!=0x80) || (uartBuf[1]!=0x80) )
 146   1        {
 147   2          Control_Motor(uartBuf[2],uartBuf[1]);
 148   2          
 149   2          Set_TimeOut_Motor();//复位超时计数
 150   2        }
 151   1        
 152   1        if(uartBuf[3] != 0x00)//0x00空闲信号
 153   1        {
 154   2          Control_ARM (uartBuf[3]);
 155   2          Control_Claw(uartBuf[4]);
 156   2        }
 157   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    274    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =      8       5
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
