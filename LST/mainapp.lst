C51 COMPILER V9.52.0.0   MAINAPP                                                           11/21/2017 14:50:47 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAINAPP
OBJECT MODULE PLACED IN .\Output\mainapp.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Code\mainapp.c OPTIMIZE(4,SPEED) BROWSE INCDIR(.\Code\Common;.\Code;.\Co
                    -de\BSP;.\Code\N76E003_HW) DEFINE(FOSC_160000) DEBUG OBJECTEXTEND PRINT(.\LST\mainapp.lst) TABS(2) OBJECT(.\Output\mainap
                    -p.obj)

line level    source

   1          /*--------------------------------------------------------------------------------------------------------
             --*/
   2          /*                                                                                                        
             - */
   3          /* Copyright(c) 2017 Buta Technology Corp. All rights reserved.                                         */
   4          /*                                                                                                        
             - */
   5          /*--------------------------------------------------------------------------------------------------------
             --*/
   6          
   7          //********************************************************************************************************
             -***
   8          //  Website: http://www.ptahtoy.com
   9          //  E-Mail : linshigao@ptahtoy.com
  10          //  Date   : Jun/24/2017
  11          //********************************************************************************************************
             -***
  12          
  13          //********************************************************************************************************
             -***
  14          //  File Function: BabyMonkey(Finger Toy) 
  15          //********************************************************************************************************
             -***
  16          #include "N76E003.h"
  17          #include "Common.h"
  18          #include "Delay.h"
  19          #include "Audio.h"
  20          #include "Board.h"
  21          #include "PWM.h"
  22          #include "motor.h"
  23          #include "SFR_Macro.h"
  24          #include "Function_define.h"
  25          #include "string.h"
  26          #include "UART.h"
  27          #include "LED.h"
  28          #include "ADC.h"
  29          #include "voltage.h"
  30          #include "SFR_Macro.h"
  31          
  32          /***********************Local function Define***********************/
  33          static void AppInit(void);
  34          static void AppTask(void);
  35          static void ClearSensorStatus(void);
  36          static void WakeupAction(void);
  37          /***********************Local Variables Define***********************/
  38          
  39          EUINT8 midletick;//1s per tick
  40           
  41          u8  uartData = 0; //????
  42          //u8  uartBuf[DATA_LEN];
  43          u8  num = 0;
  44          
  45          u8 dataPacket0;
C51 COMPILER V9.52.0.0   MAINAPP                                                           11/21/2017 14:50:47 PAGE 2   

  46          u8 dataPacket1;
  47          u8 speed = 0x00;
  48          u16 timeOutSonix = 0;//?????????
  49          
  50          void delay(void)   //
  51          {
  52   1          unsigned char a,b;
  53   1          for(b=20;b>0;b--)
  54   1              for(a=1;a>0;a--);
  55   1      } 
  56          
  57          /*******************************************************************/
  58          //UINT16 mtcnt,mprevtcnt;
  59          void main (void) 
  60          {
  61   1        u8 il=0;
  62   1      //  UINT16 minus;
  63   1        u8 motorOutFlag = 0;
  64   1        u16 i=0;
  65   1      //  u16 adc_val;
  66   1      
  67   1        //AppInit();
  68   1        BoardInit();
  69   1        
  70   1        // Test code
  71   1      //  for(il=0;il<12;il++)
  72   1      //  {
  73   1      //    WDT_Reset();
  74   1      //    delayms(10);
  75   1      //    Turn_LED();
  76   1      //  }
  77   1        
  78   1        //delay();
  79   1        
  80   1        //MyPrintf("Hello WiFI Car \r\n");
  81   1        
  82   1        Set_Bat_TH();//设置电池电量检测阈值
  83   1        while(1)
  84   1        {
  85   2          if(GetSysClock())//500uS
  86   2          {
  87   3            ResetSysClock();
  88   3            WDT_Reset();
  89   3            
  90   3            Voltage_Monitor();
  91   3            
  92   3            if(Check_Recieve_Valid())//接收到有效的数据包
  93   3            {
  94   4              Rx_Package_Handle(RX_Packet);
  95   4            }
  96   3            
  97   3            if(CheckTimeOut_Wifi())//WIFI信号超时
  98   3            {
  99   4              SetMotor_Brake();//刹车
 100   4              SetArm( ARM_STOP );
 101   4              SetClaw( CLAW_STOP );
 102   4            } 
 103   3            else 
 104   3            {
 105   4              //前后信号接收超时，刹车
 106   4              if(CheckTimeOut_Motor())
 107   4              {
C51 COMPILER V9.52.0.0   MAINAPP                                                           11/21/2017 14:50:47 PAGE 3   

 108   5                SetMotor_Brake();//刹车
 109   5              }
 110   4            }
 111   3            
 112   3            if(CheckTimeOut_Claw())//检测前爪停转
 113   3            {
 114   4              if(Check_Claw_EN())
 115   4              {
 116   5                Reset_Claw_EN();  
 117   5                Claw_Trun();//前爪反转
 118   5              }       
 119   4            }
 120   3              
 121   3            Indicator_Light();//指示灯显示
 122   3          }
 123   2        }
 124   1      }
 125          
 126          /*
 127          应用层的一些初始化
 128          */
 129          static void AppInit(void)
 130          {
 131   1        
 132   1      }
 133          
 134          /*
 135          应用层任务
 136          */
 137          static void AppTask(void)
 138          {
 139   1         
 140   1      }
 141          
 142          /*
 143            接收数据解析
 144            RX_Handle
 145          */
 146          void Rx_Package_Handle(uint8_t *uartBuf)
 147          {
 148   1        Set_TimeOut_Wifi();//WIFI超时复位
 149   1        SetWifiStatus();//设置WIFI为连接状态
 150   1        
 151   1        //if(Get_Vol_Status() == NORMAL)
 152   1        {
 153   2          if( (uartBuf[2]!=0x80) || (uartBuf[1]!=0x80) )
 154   2          {
 155   3            Control_Motor(uartBuf[2],uartBuf[1]);
 156   3            
 157   3            Set_TimeOut_Motor();//复位超时计数
 158   3          }
 159   2          
 160   2          if(uartBuf[3] != 0x00)//0x00空闲信号
 161   2          {
 162   3            Control_ARM (uartBuf[3]);
 163   3            Control_Claw(uartBuf[4]);
 164   3          }
 165   2        }
 166   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V9.52.0.0   MAINAPP                                                           11/21/2017 14:50:47 PAGE 4   

   CODE SIZE        =    230    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      8       4
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
